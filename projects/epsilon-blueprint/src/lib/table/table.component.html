<div class="row">
  <div class="col-md-6 col-lg-4 col-xl-3">
    <!-- Table Filters -->
    <bp-search
      (search)="search($event)"
      (clearSearch)="clearSearch()"
    ></bp-search>
  </div>
  <ng-content select="[table-filters]"></ng-content>
</div>
<div class="table-responsive">
  <table
    class="table"
    [ngClass]="densityClass"
    [class.table-selectable-rows]="properties.hasSelectableRows"
  >
    <caption class="sr-only">{{ properties.caption }}</caption>
    <!-- Table Headings -->
    <thead>
      <tr>
        <ng-container *ngIf="properties.columns">
          <th *ngIf="properties.hasSelectableRows" class="th-selectable">
            <input
              type="checkbox"
              id="selectAllRows"
              #selectAllRowsRef
              (change)="onSelectAllRows($event)"
            />
            <label for="selectAllRows" class="sr-only">{{ properties.selectCheckBoxLabel }}</label>
          </th>
          <th
            scope="col"
            [hidden]="!column.isColumnDisplayed"
            *ngFor="let column of properties.columns; let i = index"
            [attr.aria-sort]="isSortActive ? getAriaSortOrder(i) : 'null'"
          >
            <button class="th-sortable" (click)="applySort(column.key, i)">
              {{ column.headerText }}
            </button>
          </th>
          <ng-container *ngIf="properties.actions">
            <th
              *ngIf="properties.actions.length < 3"
              scope="col"
              class="th-not-sortable"
            >
            {{ properties.actionsVisibleHeader }}
            </th>
            <th
              *ngIf="properties.actions.length >= 3"
              scope="col"
              class="th-not-sortable more-actions"
            >
              <span class="sr-only">
                {{ properties.actionsHiddenHeader }}</span>
            </th>
          </ng-container>
        </ng-container>
      </tr>
    </thead>

    <!-- Table Loading -->
    <tbody *ngIf="isDataLoading; else loaded">
      <tr class="table-empty">
        <td colspan="100%">
          <i class="fa fa-spinner fa-spin icon-left" aria-hidden="true"></i>
          {{ properties.loadingText }} 
        </td>
      </tr>
    </tbody>

    <!-- Table Loaded -->
    <ng-template #loaded>
      <tbody
        table-body
        *ngIf="tableData.length > 0; else noColumnData"
        [tableData]="tableData"
        [properties]="properties"
        [pageData]="pageData"
        (action)="emitAction($event)"
        (selectedRowsAction)="onSelectRow($event)"
      ></tbody>
    </ng-template>

    <!-- Table Empty -->
    <ng-template #noColumnData>
      <tbody>
        <tr class="table-empty">
          <td colspan="100%">
            {{ properties.noDataText }} 
          </td>
        </tr>
      </tbody>
    </ng-template>
  </table>
</div>

<!-- Table Footer -->
<app-table-footer
  *ngIf="totalRecords"
  class="row justify-content-center justify-content-xl-start align-items-center mb-3"
  [totalRecords]="totalRecords"
  [defaultNumberOfRows]="defaultNumberOfRows"
  [pageBuffer]="pageBuffer"
  [pageNumber]="currentPage"
  [showColumnSelector]="properties.hasColumnSelector"
  [columnInfo]="properties.columns"
  [defaultSortColumnName]="properties.sort.defaultSortedColumn"
  (pageData)="paginate($event)"
  (displayDensityEmitter)="setDisplayDensity($event)"
  [showDisplayDensity]="properties.hasDisplayDensity"
  [displayDensityText]="properties.displayDensityLabel"
  [columnSelectorText]="properties.columnSelectorLabel"
  [loadingLabelText]="properties.loadingLabel"
  [outOfLabelText]="properties.outOfLabel"
  [defaultText]="properties.defaultLabel"
  [numberOfRowsText]="properties.numberOfRowsLabel"
  [firstPageLabel]="properties.firstPageText"
  [previousPageLabel]="properties.previousPageText"
  [nextPageLabel]="properties.nextPageText"
  [lastPageLabel]="properties.lastPageText"
></app-table-footer>
