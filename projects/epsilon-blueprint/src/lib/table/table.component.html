<div class="row">
  <div class="col-md-6 col-lg-4 col-xl-3">
    <!-- Table Filters -->
    <bp-search
      (search)="search($event)"
      (clearSearch)="clearSearch()"
    ></bp-search>
  </div>
  <ng-content select="[table-filters]"></ng-content>
</div>
<div class="table-responsive">
  <table
    class="table"
    [ngClass]="densityClass"
    [class.table-selectable-rows]="properties.hasSelectableRows"
  >
    <caption class="sr-only">{{ properties.caption }}</caption>
    <!-- Table Headings -->
    <thead>
      <tr>
        <ng-container *ngIf="properties.columns">
          <th *ngIf="properties.expandableRowsTemplate" class="th-expandable">
            <span class="sr-only">
              {{ properties.internationalization['Expand/Collapse'] }}
            </span>
          </th>
          <th *ngIf="properties.hasSelectableRows" class="th-selectable">
            <app-select-all-checkbox
              id="selectAllRows"
              [label]="properties.internationalization['Select all rows']"
              [visuallyHiddenLabel]="true"
              [isChecked]="isSelectAllChecked"
              [isMixed]="isSelectAllIndeterminate"
              (change)="onSelectAllRows($event)"
            ></app-select-all-checkbox>
          </th>
          <ng-container *ngFor="let column of properties.columns; let i = index">
            <th
              *ngIf="column.isSortable; else columnNotSortable"
              class="th-sortable"
              scope="col"
              [hidden]="!column.isColumnDisplayed"
              [attr.aria-sort]="isSortActive ? getAriaSortOrder(i) : 'null'"
            >
              <button (click)="applySort(column.key, i)">
                {{ column.headerText }}
              </button>
            </th>
            <ng-template #columnNotSortable>
              <th
                scope="col"
                class="th-not-sortable"
              >
                {{ column.headerText }}
              </th>
            </ng-template>
          </ng-container>
          <ng-container *ngIf="properties.actions">
            <th
              *ngIf="properties.actions.length < 3"
              scope="col"
              class="th-not-sortable"
            >
              {{ properties.internationalization['Actions'] }}
            </th>
            <th
              *ngIf="properties.actions.length >= 3"
              scope="col"
              class="th-not-sortable more-actions"
            >
              <span class="sr-only">
                {{ properties.internationalization['Actions'] }}
              </span>
            </th>
          </ng-container>
        </ng-container>
      </tr>
    </thead>

    <!-- Table Loading -->
    <tbody *ngIf="isDataLoading; else loaded">
      <tr class="table-empty">
        <td colspan="100%">
          <i class="fa fa-spinner fa-spin icon-left" aria-hidden="true"></i>
          {{ properties.internationalization['Loading data'] }}
        </td>
      </tr>
    </tbody>

    <!-- Table Loaded -->
    <ng-template #loaded>
      <ng-container *ngIf="tableData.length > 0; else noColumnData">
        <tbody
          app-table-body
          [tableData]="tableData"
          [properties]="properties"
          (action)="emitAction($event)"
          (selectedRowsAction)="onSelectRow($event)"
        ></tbody>
      </ng-container>
    </ng-template>

    <!-- Table Empty -->
    <ng-template #noColumnData>
      <tbody>
        <tr class="table-empty">
          <td colspan="100%">
            {{ properties.internationalization['No data'] }}
          </td>
        </tr>
      </tbody>
    </ng-template>
  </table>
</div>

<!-- Table Footer -->
<app-table-footer
  *ngIf="totalRecords"
  class="row justify-content-center justify-content-xl-start align-items-center mb-3"
  [totalRecords]="totalRecords"
  [defaultNumberOfRows]="defaultNumberOfRows"
  [pageBuffer]="pageBuffer"
  [pageNumber]="currentPage"
  [showColumnSelector]="properties.hasColumnSelector"
  [columnInfo]="properties.columns"
  [defaultSortColumnName]="properties.sort.defaultSortedColumn"
  (pageData)="paginate($event)"
  (displayDensityEmitter)="setDisplayDensity($event)"
  [showDisplayDensity]="properties.hasDisplayDensity"
  [internationalization]="properties.internationalization"
></app-table-footer>
