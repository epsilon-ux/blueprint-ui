<ng-container *ngFor="let rowData of tableData; let index = index">
  <tr class="{{ index % 2 === 0 ? 'tr-stripe-even' : 'tr-stripe-odd' }}">
    <!-- Expandable Rows Icon -->
    <td *ngIf="properties.expandableRowsTemplate" class="td-expandable">
      <button
        class="btn-icon-inline"
        [attr.aria-expanded]="expandedRows.has(rowData[properties.rowId])"
        attr.aria-controls="expandable{{ rowData[properties.rowId] }}"
        (click)="toggleExpanded(rowData[properties.rowId])"
      >
        <i
          class="fas"
          [ngClass]="{
            'fa-caret-right': !expandedRows.has(rowData[properties.rowId]),
            'fa-caret-down': expandedRows.has(rowData[properties.rowId])
          }"
        ></i>
        <span class="sr-only">{{parseLookupString(properties.internationalization['Toggle Row'], rowData)}}</span>
      </button>
    </td>

    <!-- Selectable Row Checkboxes -->
    <td *ngIf="properties.hasSelectableRows" class="td-selectable">
      <bp-checkbox
        [label]="parseLookupString(properties.internationalization['Select Row'], rowData)"
        [visuallyHiddenLabel]="true"
        [isChecked]="rowSelectionStates.get(rowData)"
        (change)="selectRows($event, rowData)"
      ></bp-checkbox>
    </td>

    <!-- Table Data Columns/Cells -->
    <td
      *ngFor="let column of properties.columns"
      [hidden]="!column.isColumnDisplayed"
      [ngSwitch]="column.type"
    >
      <!-- Link Column -->
      <ng-container *ngSwitchCase="columnType.LINK">
        <bp-action
          [text]="rowData[column.key]"
          classes="btn-text"
          [ariaLabel]="parseLookupString(column.link.ariaLabel, rowData)"
          [bpRouterLink]="column.link.bpRouterLink ? parseLookupString(column.link.bpRouterLink, rowData) : null"
          [href]="column.link.href ? parseLookupString(column.link.href, rowData) : null"
          (click)="column.link.action ? emitAction(column.link.action, rowData[properties.rowId]) : null"
        ></bp-action>
      </ng-container>
      <!-- Icon Column -->
      <ng-container *ngSwitchCase="columnType.ICON">
        <i
          class="fas"
          [ngClass]="[
            column.icon.mapping[rowData[column.key]],
            'icon-color-' + column.icon.color
          ]"
          [attr.aria-label]="rowData[column.key]"
        ></i>
      </ng-container>
      <!-- Status Indicator Column -->
      <span *ngSwitchCase="columnType.STATUS" class="status-indicator">
        <div
          *ngIf="
            column.statusIndicatorMapping['in-progress'] !== rowData[column.key]
          "
          class="status-icon"
          [ngClass]="
            getStatusClass(rowData[column.key], column.statusIndicatorMapping)
          "
          aria-hidden="true"
        ></div>
        <i
          *ngIf="
            column.statusIndicatorMapping['in-progress'] === rowData[column.key]
          "
          class="fa fa-spinner fa-spin in-progress"
          aria-hidden="true"
        ></i>
        {{ rowData[column.key] }}
      </span>
      <!-- Template Column -->
      <ng-container *ngSwitchCase="columnType.TEMPLATE">
        <ng-container
          *ngTemplateOutlet="column.template; context: { $implicit: rowData }"
        ></ng-container>
      </ng-container>
      <!-- Standard Column -->
      <ng-container *ngSwitchDefault>{{ rowData[column.key] }}</ng-container>
    </td>

    <!-- Actions Column -->
    <td
      *ngIf="properties.actions"
      class="{{ properties.actions.length < 3 ? 'actions' : 'more-actions' }}"
    >
      <!-- May move into its own nested component if table gets too large -->
      <app-actions
        *ngIf="properties.actions.length < 3; else moreActions"
        class="action-items"
        [actionItems]="properties.actions"
        [rowId]="properties.rowId"
        [rowData]="rowData"
        classList="btn btn-sm"
        (emitAction)="emitAction($event, rowData[properties.rowId])"
      ></app-actions>
      <ng-template #moreActions>
        <div class="dropdown">
          <button
            id="moreActions{{ rowData[properties.rowId] }}"
            class="btn-icon-inline more-actions-toggle"
            data-toggle="dropdown"
            [attr.aria-label]="properties.internationalization['Actions Menu']"
            aria-haspopup="true"
            aria-expanded="false"
          >
            <i class="fa fa-ellipsis-h" aria-hidden="true"></i>
          </button>
          <app-actions
            class="dropdown-menu dropdown-menu-right"
            attr.aria-labelledby="moreActions{{ rowData[properties.rowId] }}"
            [actionItems]="properties.actions"
            [rowId]="properties.rowId"
            [rowData]="rowData"
            classList="dropdown-item"
            (emitAction)="emitAction($event, rowData[properties.rowId])"
          ></app-actions>
        </div>
      </ng-template>
    </td>
  </tr>

  <!-- Expandable Row Content -->
  <tr
    *ngIf="properties.expandableRowsTemplate && expandedRows.has(rowData[properties.rowId])"
    class="tr-expandable {{
      index % 2 === 0 ? 'tr-stripe-even' : 'tr-stripe-odd'
    }}"
    id="expandable{{ rowData[properties.rowId] }}"
  >
    <td colspan="100%">
      <ng-container
        *ngTemplateOutlet="
          properties.expandableRowsTemplate;
          context: { $implicit: rowData }
        "
      >
      </ng-container>
    </td>
  </tr>
</ng-container>
