<nav [id]="uuid" class="nav-secondary">
  <p *ngIf="title" class="title">{{ title }}</p>
  <ul class="nav-list">
    <ng-container *ngTemplateOutlet="lists; context:{$implicit: items}"></ng-container>
  </ul>
</nav>

<ng-template #lists let-navItems>
  <li *ngFor="let item of navItems; let index = index" class="nav-item">
    <!-- Current node has children -->
    <ng-container *ngIf="item.children; else noChildren">
      <!-- Expand Collapse button -->
      <ng-container *ngTemplateOutlet="navItem; context:{$implicit: item, index: index}"></ng-container>
      <!-- Node's children in list -->
      <ul [ngClass]="{'collapse nested-list': true, 'show': item.isExpanded || areItemsExpanded}" id="nestedList{{ uuid }}-{{ index }}">
        <ng-container *ngTemplateOutlet="lists; context:{$implicit: item.children}"></ng-container>
      </ul>
    </ng-container>
    <!-- Current node has no children -->
    <ng-template #noChildren>
      <ng-container *ngTemplateOutlet="navItem; context:{$implicit: item, index: index}"></ng-container>
    </ng-template>
  </li>
</ng-template>

<ng-template #navItem let-item let-i="index">
  <!-- Nav link -->
  <a
    *ngIf="item.route !== undefined"
    [attr.id]="uuid + 'Action' + i"
    routerLink="{{ item.route }}"
    routerLinkActive="active"
    [routerLinkActiveOptions]="{exact: shouldRouteMatchExact}"
    class="nav-link"
  >
    {{ item.text }}
  </a>
  <!-- Expand/Collapse button -->
  <button
    *ngIf="item.children"
    type="button"
    [attr.id]="uuid + 'Action' + i"
    [ngClass]="{'nav-link-parent': true, 'collapsed': !(item.isExpanded || areItemsExpanded)}"
    data-toggle="collapse"
    attr.data-target="#nestedList{{ uuid }}-{{ i }}"
    attr.aria-expanded="{{ item.isExpanded || areItemsExpanded }}"
    attr.aria-controls="nestedList{{ uuid }}-{{ i }}"
  >
    {{ item.text }}
  </button>
</ng-template>